(()=>{(function(){"use strict";const r={featureFlagKey:"homepage-button-test",experimentKey:"homepage-button-ab-test",testButtonText:"Get Started",maxWaitTime:2e3,debug:!1};function a(...e){}function p(){const e=document.querySelectorAll('[data-ab-button="true"]');a("Found",e.length,"buttons to test"),e.forEach(t=>{t.style.setProperty("opacity","0","important"),t.style.transition="opacity 0.3s ease";const n=t.textContent.trim();t.setAttribute("data-original-text",n),a("Button stored with original text:",n)}),document.querySelectorAll('[data-hide-until-button-ready="true"]').forEach(t=>{t.style.setProperty("opacity","0","important"),t.style.transition="opacity 0.3s ease"})}function s(e){const o=document.querySelectorAll('[data-ab-button="true"]');a("Applying variant:",e,"to",o.length,"buttons"),o.forEach(t=>{if(e==="test")t.textContent=r.testButtonText,a("Button changed to test text:",r.testButtonText);else{const n=t.getAttribute("data-original-text");n&&(t.textContent=n,a("Button kept original text:",n))}t.style.setProperty("opacity","1","important")}),document.querySelectorAll('[data-hide-until-button-ready="true"]').forEach(t=>{t.style.setProperty("opacity","1","important")}),document.body.setAttribute("data-button-variant",e)}function m(){return new Promise((e,o)=>{if(!window.posthog){o(new Error("PostHog not initialized"));return}a("Getting feature flag:",r.featureFlagKey);let t=!1;posthog.onFeatureFlags(()=>{if(!t){t=!0;const i=posthog.getFeatureFlag(r.featureFlagKey);a("Feature flag callback fired with value:",i),e(i)}});let n=0;const u=Math.floor(r.maxWaitTime/25),l=()=>{n++;const i=posthog.getFeatureFlag(r.featureFlagKey);i!==void 0&&!t?(t=!0,a("Feature flag polling succeeded with value:",i),e(i)):n>=u&&!t?(t=!0,a("Feature flag polling timed out"),o(new Error("Feature flag timeout"))):t||setTimeout(l,25)};setTimeout(l,25)})}function f(e){if(window.posthog&&!window._homepageButtonExposureTracked){window._homepageButtonExposureTracked=!0;try{a("Tracking experiment exposure for variant:",e),posthog.capture("$feature_flag_called",{$feature_flag:r.featureFlagKey,$feature_flag_response:e,$feature_flag_payload:{experiment_key:r.experimentKey,variant:e,experiment_type:"button_text_test",version:"1.0"}}),posthog.capture("experiment_exposure",{experiment_key:r.experimentKey,variant:e,page_path:window.location.pathname,feature_flag:r.featureFlagKey,experiment_version:"1.0",experiment_type:"button_text_test"})}catch(o){a("Error tracking exposure:",o),window._homepageButtonExposureTracked=!1}}}function g(){let e=null,o=null;function t(){return e===null&&window.posthog&&(o=posthog.getFeatureFlag(r.featureFlagKey),e=o==="test"?"test":"control"),{variant:e,flagValue:o}}document.addEventListener("click",function(n){if(n.target.matches('[data-ab-button="true"]')){const{variant:u,flagValue:l}=t();if(window.posthog)try{a("Tracking button click for variant:",u),posthog.capture("homepage_button_clicked",{experiment_key:r.experimentKey,variant:u,button_text:n.target.textContent,original_text:n.target.getAttribute("data-original-text"),button_id:n.target.id||"unknown",button_class:n.target.className||"unknown",page_path:window.location.pathname,feature_flag:r.featureFlagKey,feature_flag_value:l,experiment_version:"1.0",timestamp:new Date().toISOString()})}catch(i){a("Error tracking button click:",i)}}})}async function c(){a("Starting homepage button experiment"),p();const e=setTimeout(()=>{a("Emergency timeout triggered, showing control variant"),s("control"),g()},r.maxWaitTime);try{if(!window.posthog)throw new Error("PostHog is not available on window.posthog");a("PostHog is available, getting feature flag");const o=await m();clearTimeout(e);const t=o==="test"?"test":"control";if(a("Determined variant:",t,"from flag value:",o),f(t),s(t),g(),window.posthog)try{posthog.capture("homepage_button_test_initialized",{experiment_key:r.experimentKey,variant:t,timestamp:new Date().toISOString(),page_url:window.location.href})}catch(n){a("Error sending test event:",n)}}catch(o){if(a("Experiment error:",o),clearTimeout(e),window.posthog)try{posthog.capture("homepage_button_test_error",{experiment_key:r.experimentKey,error:o.message,page_path:window.location.pathname,error_type:"initialization_error"})}catch(t){a("Error tracking error:",t)}s("control"),g()}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",c):c(),window.HomepageButtonABConfig=r})();})();
